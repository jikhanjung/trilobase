# P56: 2026 Q1 로드맵

**작성일:** 2026-02-17
**유형:** Plan (로드맵)
**선행 문서:** P45 (초기 로드맵), P52–P53 (Taxonomic Opinions), P54 (Auto-Discovery), P55 (Hierarchy 통합)

---

## 현재 상태 요약

| 항목 | 상태 |
|------|------|
| SCODA Desktop 범용 뷰어 | ✅ 도메인 코드 0줄, 완전 범용 |
| FastAPI 단일 ASGI 스택 | ✅ Flask 제거, MCP 통합 완료 |
| Pydantic response_model | ✅ OpenAPI 자동 문서화 |
| .scoda 패키지 포맷 | ✅ trilobase.scoda + paleocore.scoda |
| UID 커버리지 | ✅ 7개 테이블 10,384건 100% |
| 테스트 | ✅ 231개 통과 |
| Hierarchy View 통합 | ✅ tree + nested_table → `type: "hierarchy"` |

---

## 로드맵

### Track A: Generic Viewer 강화

manifest 없이도 동작하는 범용성 향상. 패키지 제작 진입장벽을 낮추는 방향.

#### A-1. Auto-Discovery Detail View (P54)

**목표:** manifest에 detail view가 없는 table에도 행 클릭 → 자동 detail 모달 제공.

**작업:**
- `/api/auto/detail/{table_name}?id=N` 엔드포인트 추가 (PRAGMA table_info 기반)
- `renderAutoDetail()` JS 함수 — DB 컬럼을 field_grid로 자동 렌더링
- `openDetail()` fallback 로직
- 보안: sqlite_master 존재 확인, 메타데이터 테이블 접근 차단

**규모:** app.py ~30줄, app.js ~40줄, 테스트 ~5개
**의존성:** 없음 (독립)

#### A-2. Manifest Validator / Linter

**목표:** .scoda 패키지 빌드 시 manifest의 누락/불일치를 사전 검출.

**동기:** PaleoCore chart_options 누락 버그, Bibliography detail composite 미전환 등이 반복됨.

**작업:**
- `scripts/validate_manifest.py`: manifest JSON 검증 스크립트
  - detail view 참조 유효성 (on_row_click.detail_view가 존재하는지)
  - source_query가 ui_queries에 존재하는지
  - chart_options의 필수 키 존재 여부 (order_key, rank_columns 등)
  - sub_queries 파라미터 매핑 검증
- `create_scoda.py` 빌드 시 자동 실행

**규모:** 스크립트 ~150줄, 테스트 ~10개
**의존성:** 없음 (독립)

#### A-3. Manifest Schema 정규화 (DB 레벨)

**목표:** DB의 manifest를 새 hierarchy 스키마로 업데이트. 현재는 클라이언트의 `normalizeViewDef()`가 런타임 변환 중.

**작업:**
- `trilobase.db`, `paleocore.db`의 ui_manifest를 `type: "hierarchy"` + `display` 형식으로 직접 업데이트
- `add_scoda_manifest.py`, `create_paleocore.py` 스크립트 갱신
- `normalizeViewDef()`는 하위 호환용으로 유지

**규모:** 스크립트 수정, DB UPDATE
**의존성:** P55 완료 (✅)

---

### Track B: Taxonomic Opinions

분류학 데이터 모델의 근본적 확장. 복수 견해를 기록하고 비교하는 구조.

#### B-1. PoC — taxonomic_opinions 테이블 (P52 Phase 1)

**목표:** `taxonomic_opinions` 테이블 추가, Eurekiidae 1건 시범 입력, UI 표시.

**작업:**
- `taxonomic_opinions` 테이블 생성 (CHECK 제약, partial unique index)
- `is_placeholder` 컬럼 추가 (Uncertain Order 등 구분)
- trigger: `is_accepted` 변경 → `parent_id` 자동 동기화
- bibliography에 Adrain 2011 추가 (opinions에서 FK 참조용)
- Eurekiidae: 3건 opinion 입력 (Uncertain/Asaphida/Ptychopariida)
- API: `GET /api/composite/rank_detail` → opinions 섹션 추가
- UI: Rank detail 모달에 "Taxonomic Opinions" linked_table
- MCP: `get_taxon_opinions` 도구 추가

**규모:** DB 스키마 변경, app.py ~50줄, manifest 갱신, 테스트 ~15개
**의존성:** 없음 (별도 브랜치 `feature/taxonomic-opinions`에서 작업)

#### B-2. 확장 — 56개 Uncertain Family 입력 (P52 Phase 2)

**목표:** "Uncertain" Order 소속 56개 Family에 대해 문헌 기반 opinion 입력.

**작업:**
- 56개 Family × 1~3개 opinion = 약 100건 입력
- 입력 스크립트 작성 (bibliography 매칭 자동화)
- "Uncertain" → 실제 Order 재배치 가능한 건 `is_accepted` 전환
- 통계 대시보드: opinion 커버리지 표시

**의존성:** B-1 완료

#### B-3. 장기 — Assertion-Centric 전환 검토 (P53)

**목표:** `parent_id`를 assertions에서 완전히 파생하는 모델로 전환 가능성 검토.

**조건:** B-2 완료 후, 복수 분류 체계가 실제로 필요한 사례가 충분히 축적될 때.
**현 단계에서는 설계 문서(P53)만 존재. 구현 미정.**

---

### Track C: 배포/운영 개선

#### C-1. PyInstaller 빌드 검증

**목표:** FastAPI 전환 후 EXE 빌드가 정상 동작하는지 검증.

**작업:**
- `scripts/build.py` 실행 → ScodaDesktop.exe, ScodaMCP.exe 생성
- Windows에서 .scoda 로딩, 웹 브라우저, MCP stdio 테스트
- `ScodaDesktop.spec` hidden imports 점검 (fastapi, uvicorn, httpx 등)

**규모:** 빌드 + 수동 테스트
**의존성:** 없음

#### C-2. SCODA 백오피스 (장기)

**목표:** .scoda 패키지를 관리/패키징하는 웹 기반 도구.

**범위:** manifest 시각적 편집, 쿼리 검증, 패키지 빌드, UID 참조 검증.
**현 단계에서는 구상만 존재. 별도 프로젝트로 분리 가능.**

---

## 우선순위 및 의존 관계

```
독립 작업 (병렬 가능)
├── A-1. Auto-Discovery Detail View     [소규모, 즉시 착수 가능]
├── A-2. Manifest Validator             [소규모, 버그 예방 효과 높음]
├── A-3. Manifest Schema 정규화         [소규모, 기술 부채 해소]
└── C-1. PyInstaller 빌드 검증          [소규모, 배포 준비]

순차 작업
B-1. Taxonomic Opinions PoC             [중규모, 별도 브랜치]
  └── B-2. 56개 Uncertain Family 확장   [중규모]
        └── B-3. Assertion-Centric 검토  [장기, 조건부]

장기
└── C-2. SCODA 백오피스                  [대규모, 별도 프로젝트]
```

## 권장 착수 순서

| 순서 | 항목 | 이유 |
|------|------|------|
| 1 | A-2 Manifest Validator | 반복되는 manifest 버그 방지, 즉시 효과 |
| 2 | A-1 Auto-Discovery | 범용 뷰어 완성도 향상, 소규모 |
| 3 | A-3 Manifest 정규화 | hierarchy 통합의 마무리 |
| 4 | C-1 PyInstaller 검증 | 배포 준비 확인 |
| 5 | B-1 Opinions PoC | 데이터 모델 확장의 첫 걸음, 별도 브랜치 |

---

## 미해결 데이터 항목 (변동 없음)

- Synonym 미연결 4건 (원본에 senior taxa 없음)
- parent_id NULL인 Genus 342건 (family가 NULL인 무효 taxa)
- Location/Formation 없는 taxa는 모두 무효 taxa (정상)
