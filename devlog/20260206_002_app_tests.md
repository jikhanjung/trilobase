# app.py 테스트 작성

**날짜:** 2026-02-06
**파일:** `test_app.py`

## 개요

Flask 웹 애플리케이션(`app.py`)에 대한 pytest 기반 테스트 스위트 작성.

## 테스트 구성

| 테스트 클래스 | 테스트 수 | 대상 엔드포인트 |
|---|---|---|
| `TestIndex` | 1 | `GET /` |
| `TestApiTree` | 7 | `GET /api/tree` |
| `TestApiFamilyGenera` | 8 | `GET /api/family/<id>/genera` |
| `TestApiRankDetail` | 8 | `GET /api/rank/<id>` |
| `TestApiGenusDetail` | 13 | `GET /api/genus/<id>` |
| **합계** | **37** | |

## 테스트 인프라

- **pytest fixture**: `test_db` — 임시 디렉토리에 SQLite 테스트 DB 생성
- **pytest fixture**: `client` — `monkeypatch`로 `DATABASE` 경로를 테스트 DB로 교체, Flask test client 제공
- 실제 `trilobase.db`에 의존하지 않음 (독립 실행 가능)

## 테스트 데이터

테스트 DB에 삽입한 샘플 데이터:

- **Class**: Trilobita
- **Order**: Phacopida, Ptychopariida
- **Family**: Phacopidae (→ Phacopida), Olenidae (→ Ptychopariida)
- **Genus**: Phacops (valid), Acuticryphops (valid), Cryphops (invalid/synonym), Olenus (valid)
- **Synonym**: Cryphops → Acuticryphops (j.s.s.)
- **Formation**: Büdesheimer Sh, Alum Sh
- **Country**: Germany, Sweden
- **Relation**: genus_formations, genus_locations

## 주요 검증 항목

- 각 API 엔드포인트 정상 응답 (HTTP 200)
- 응답 JSON 구조 (필수 키 존재 여부)
- 404 에러 처리 (존재하지 않는 ID, 잘못된 rank 타입)
- 트리 계층 구조 (Class → Order → Family, Genus 미포함)
- Genus 목록 이름순 정렬
- valid/invalid genus 구분
- Synonym, Formation, Location 관계 데이터 조회
- 관계 데이터 없는 경우 빈 리스트 반환

## 결과

```
37 passed in 7.96s
```

## 의존성 추가

- `pytest` 설치 (`pip install pytest`)
